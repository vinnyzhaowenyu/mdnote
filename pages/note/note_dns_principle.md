---
title: DNS解析原理
keywords: dns,service 
last_updated: August 10, 2017
tags: [dns,service]
summary: dns 
sidebar: note_sidebar
permalink: note_dns_principle.html
folder: note 
---

DNS的目的是提供域名到IP地址对应关系

## 解析过程
### 递归查询
即客户端向本地DNS服务器请求查询域名，本地DNS服务器收到查询任务后如自身无法回答则向其他服务器查询，直到查到结果后返回结果给客户端。期间DNS服务器可能要查询很多其他DNS服务器。
### 迭代查询
即客户端向本地服务器请求查询域名，本地DNS服务器无法回答，则给客户端返回另一个能查询域名的服务器地址，客户端再向另一服务器查询，期间可能客户端需查询多个DNS服务器，最终查到结果。

以`www.baidu.com`域名解析为例

```
[root@wenyuecs note]# ping www.baidu.com
PING www.a.shifen.com (115.239.210.27) 56(84) bytes of data.
64 bytes from 115.239.210.27 (115.239.210.27): icmp_seq=1 ttl=54 time=33.1 ms
64 bytes from 115.239.210.27 (115.239.210.27): icmp_seq=2 ttl=54 time=33.2 ms
^C
--- www.a.shifen.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1000ms
rtt min/avg/max/mdev = 33.130/33.179/33.228/0.049 ms
```

## 本地范围

#### 查询本地DNS缓存

#### 查找/etc/hosts

```
[root@wenyuecs note]# cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
```

#### /etc/resolve.conf
```
[root@wenyuecs note]# cat /etc/resolv.conf 
options timeout:1 attempts:1 rotate single-request-reopen
; generated by /usr/sbin/dhclient-script
search localdomain
nameserver 223.5.5.5
nameserver 223.6.6.6
```

#### /etc/nsswitch.conf
## 直连DNS

## DNS服务器之间


1.客户机先查询本地dns缓存
2.查找本地配置文件/etc/hosts
3.向本地dns服务器发送域名解析的请求，即/etc/rsolv.conf中指定的dns服务器
4.本地dns查询缓存，如果有直接返回给客户机；如果没有再查询本地dns区域数据库文件里是否有记录，如果有返回给客户机；如果没有查询到就向跟域“.”查询
5.根域告诉本地dns服务器找的com服务器
6.本地dns服务器向.com的服务器查询,com服务器告诉本地dns baidu这个域的dns服务器ip
7.本地dns服务器找到baidu.com域的dns服务器，查询到www这台主机的ip
8.同时放到自己的缓存里
9.告诉客户机www.baidu.com的域名对应的ip
10.客户机将ip放到缓存里






{% include links.html %}
